# Stock Price Forecasting Analytics Platform

Данный проект представляет собой аналитическую платформу для работы с временными рядами цен акций.
Решение реализовано в виде FastAPI-сервиса и предназначено для разведочного анализа данных,
проверки статистических свойств временных рядов и получения прогнозов.

---

## Архитектура проекта

Проект построен по модульному принципу и включает следующие логические уровни:

- HTTP-интерфейс на базе FastAPI
- слой работы с данными (обновление, очистка, валидация)
- слой аналитики и визуализации
- слой моделей прогнозирования
- web-интерфейс для взаимодействия с сервисом

---

## Работа с данными

### Обновление данных

Изначально в проекте лежат готовые данные до определенной даты. 
При запуске update_data данные обновляются по API финансового источника до текущего дня.

Функция обновления:
- загружает временные ряды по финансовым инструментам
- поддерживает разные временные интервалы (минута, 15 минут, час, день, неделя)
- сохраняет данные в формате Parquet

Результатом работы обновления являются файлы:
- `minute_data.parquet`
- `15min_data.parquet`
- `hour_data.parquet`
- `day_data.parquet`
- `week_data.parquet`

---

### Очистка и подготовка данных

После автообновления автоматически запускается функция очистки
- `services/data_cleaner.py`

В рамках очистки данных выполняется:
- приведение типов дат (Date / Datetime)
- удаление пропусков и некорректных значений
- сортировка временных рядов
- приведение данных к единому формату для анализа и прогнозирования

---

### Проверка и инспекция данных

Для первичной проверки и анализа данных используется модуль:

- `scripts/inspect_data.py`

Он позволяет:
- проверить структуру данных
- оценить наличие пропусков
- убедиться в корректности временных индексов
- валидировать данные перед использованием в сервисе

---

## Проверка статистических свойств данных

Для анализа временных рядов реализован модуль:

- `services/stationarity.py`

Он используется для проверки стационарности временных рядов с применением
теста Дики–Фуллера (ADF).

Результаты проверки стационарности используются, в частности, при построении
графиков ACF и PACF.

---

## Exploratory Data Analysis (EDA)

Помимо демонстрации предсказания модели было решено показывать также совйства временных рядов с помощью графиков в рамках EDA.
Проект позволяет отобразить графики по заданным параметрам.
Все визуализации вынесены в отдельный пакет `services/plots`.

Все графики формируются серверной частью и возвращаются клиенту в формате PNG. 

### Close Price
Отображает динамику цены закрытия выбранного инструмента во времени.  
Позволяет визуально оценить тренды, резкие изменения и общую волатильность.

Параметры:
- ticker
- start_date
- end_date

---

### Daily Returns
Показывает дневные доходности, рассчитанные на основе цены закрытия.  
Используется для анализа волатильности и выявления выбросов.

Параметры:
- ticker
- start_date
- end_date

---

### Structural Breaks
Выявляет структурные изменения во временном ряду с использованием методов
KernelCPD и PELT.

Параметры:
- ticker
- start_date
- end_date
- kernel_n_bkps
- pelt_penalty

---

### Correlation Matrix
Строит корреляционную матрицу между числовыми признаками для выбранного тикера.
Используется для анализа взаимосвязей и мультиколлинеарности.

Параметры:
- ticker

---

### ACF / PACF
Отображает автокорреляционную и частичную автокорреляционную функции временного ряда.
Перед построением выполняется проверка стационарности (ADF-тест).

Параметры:
- ticker
- feature
- lags

---

### Lag Plot
Строит лаговую диаграмму зависимости значений временного ряда от заданного лага.
Используется для визуальной оценки автокорреляции.

Параметры:
- ticker
- feature
- lag


Графики формируются серверной частью и передаются клиенту
через `StreamingResponse`.

---

## Прогнозирование временных рядов

Прогнозирование реализовано через универсальный эндпойнт: POST /forward

Логика прогнозирования находится в модуле:

- `services/models/forecast.py`

На данный момент для демонстрации работы сервиса для предсказания использвуются подневные данные, а также несколько моделей:
- naive
- seasonal_naive
- moving_average
- drift
- exp_smoothing

У пользователя есть возможность выбрать 
- акцию для предсказания 
- какой именно показатель хочет предсказать
- горизонт предсказания в днях
- модель для предсказания

В интерфейсе ответ реализован в виде таблицы формата 'дата : результат прогноза'.

---

### Пример запроса

```json
{
  "ticker": "AAPL",
  "target": "Close",
  "horizon": 10,
  "model": "naive"
}
```

### Пример ответа

```json
{
  "status": "ok",
  "ticker": "AAPL",
  "target": "Close",
  "model": "naive",
  "horizon": 10,
  "forecast": [
    {
      "date": "2025-01-01",
      "value": 187.3
    }
  ]
}
```
Если модель не может выполнить прогноз, сервис возвращает ошибку с кодом 403.

---

## Web-интерфейс

Проект включает web-интерфейс на HTML, расположенный в директории static. 

Интерфейс позволяет выбирать параметры для отображения графиков и получения прогнозов. Также реализованы дропдауны выбора тикеров, целевой переменной (Close, Volume и тд), даты
и модели ддля предсказания для избежания ошибочного ввода. 
При нажатии show график в формате PNG открывается в новом окне.

Главная страница доступна по корневому URL сервиса.

